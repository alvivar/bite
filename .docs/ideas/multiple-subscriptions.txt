
    Client Handler

        Receiver
            Receives from the client

            Decodes message
                If Query
                    Asks the Map for data
                    If Map changes
                        Propagate subscription
                    Send data to Sender

                If Subscription
                    Register the subscription

        Sender
            Sends to the client
